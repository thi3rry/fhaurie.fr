<button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
  <svg class="theme-toggle__icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g class="icon-moon">
      <path d="M18 11.5C17 15.08 13.62 17.5 10 17.5C5.86 17.5 2.5 14.14 2.5 10C2.5 6.38 4.92 3 8.5 2C8 3 7.75 4.13 7.75 5.25C7.75 9.39 11.11 12.75 15.25 12.75C16.37 12.75 17.5 12.5 18.5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </g>
    <g class="icon-sun">
      <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2"/>
      <line x1="10" y1="1" x2="10" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="10" y1="17" x2="10" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="19" y1="10" x2="17" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="3" y1="10" x2="1" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="16.24" y1="16.24" x2="14.83" y2="14.83" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="5.17" y1="5.17" x2="3.76" y2="3.76" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="16.24" y1="3.76" x2="14.83" y2="5.17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="5.17" y1="14.83" x2="3.76" y2="16.24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </g>
  </svg>
</button>

<style>
.theme-toggle {
  background: none;
  border: 2px solid var(--foreground);
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  margin-left: 1rem;
  width: 40px;
  height: 40px;
}

.theme-toggle:hover {
  background: var(--accent);
  border-color: var(--accent);
}

.theme-toggle__icon {
  display: block;
  color: var(--foreground);
  transition: transform 0.3s ease;
}

.theme-toggle:hover .theme-toggle__icon {
  transform: rotate(20deg);
}

.icon-moon,
.icon-sun {
  transition: opacity 0.3s ease;
}

.icon-sun {
  display: none;
}

.icon-moon {
  display: block;
}

@media (max-width: 684px) {
  .theme-toggle {
    margin-left: 0.5rem;
    width: 36px;
    height: 36px;
  }

  .theme-toggle__icon {
    width: 18px;
    height: 18px;
  }
}
</style>

<script>
(function() {
  const toggle = document.getElementById('theme-toggle');
  if (!toggle) return;

  const iconMoon = toggle.querySelector('.icon-moon');
  const iconSun = toggle.querySelector('.icon-sun');
  const body = document.body;

  function updateIcon(isDark) {
    if (isDark) {
      iconMoon.style.display = 'block';
      iconSun.style.display = 'none';
    } else {
      iconMoon.style.display = 'none';
      iconSun.style.display = 'block';
    }
  }

  // Check saved theme preference or default to dark
  const savedTheme = localStorage.getItem('theme');

  if (savedTheme === 'light') {
    // User explicitly chose light mode
    body.classList.remove('dark');
    updateIcon(false);
  } else {
    // Default to dark mode (savedTheme === 'dark' or null)
    body.classList.add('dark');
    updateIcon(true);
  }

  // Toggle theme on button click
  toggle.addEventListener('click', function() {
    body.classList.toggle('dark');
    const isDark = body.classList.contains('dark');

    updateIcon(isDark);

    if (isDark) {
      localStorage.setItem('theme', 'dark');
    } else {
      localStorage.setItem('theme', 'light');
    }
  });
})();
</script>
